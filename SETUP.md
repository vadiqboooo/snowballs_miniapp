# Инструкция по настройке и запуску

## Шаг 1: Установка зависимостей

```bash
npm install
```

## Шаг 2: Создание Telegram бота

1. Откройте Telegram и найдите [@BotFather](https://t.me/BotFather)
2. Отправьте команду `/newbot`
3. Следуйте инструкциям для создания бота
4. Сохраните полученный токен бота

## Шаг 3: Настройка переменных окружения

1. Создайте файл `.env` в корне проекта:
```bash
cp .env.example .env
```

2. Откройте `.env` и добавьте токен бота:
```
TELEGRAM_BOT_TOKEN=ваш_токен_бота_здесь
PORT=3000
```

## Шаг 4: Настройка Mini App в Telegram

1. Откройте [@BotFather](https://t.me/BotFather)
2. Отправьте команду `/newapp`
3. Выберите вашего бота из списка
4. Укажите:
   - **Title**: Снежки
   - **Description**: Игра со снежками
   - **Photo**: (опционально) загрузите картинку
   - **Short name**: snowball (или другое уникальное имя)
   - **Web App URL**: `https://ваш-домен.com` (или `http://localhost:3000` для тестирования)

## Шаг 5: Запуск сервера

### Для разработки (с автоперезагрузкой):
```bash
npm run dev
```

### Для продакшена:
```bash
npm start
```

Сервер запустится на порту 3000 (или указанном в `.env`).

## Шаг 6: Тестирование

### Локальное тестирование:

1. Для локального тестирования используйте [ngrok](https://ngrok.com/) или аналогичный сервис:
```bash
ngrok http 3000
```

2. Используйте полученный URL (например, `https://abc123.ngrok.io`) в настройках Mini App

3. Откройте вашего бота в Telegram и нажмите на кнопку Mini App

### Продакшен:

1. Разместите приложение на сервере (например, Heroku, Railway, или VPS)
2. Убедитесь, что сервер доступен по HTTPS
3. Обновите URL в настройках Mini App

## Структура базы данных

База данных SQLite создается автоматически при первом запуске в файле `snowball.db`.

Таблицы:
- `players` - информация об игроках
- `active_snowballs` - активные снежки
- `tasks` - задачи
- `player_skins` - скины персонажей

## API Endpoints

Все API endpoints начинаются с `/api/`:

- `POST /api/player/init` - Инициализация игрока
- `POST /api/player/create` - Создание нового игрока
- `GET /api/player/:telegramId` - Получить данные игрока
- `GET /api/players` - Список всех игроков
- `POST /api/snowball/throw` - Кинуть снежок
- `POST /api/snowball/return` - Откинуть снежок
- `GET /api/snowballs/active/:telegramId` - Активные снежки
- `POST /api/task/create` - Создать задачу
- `POST /api/task/solve` - Решить задачу
- `GET /api/tasks/active/:telegramId` - Активные задачи
- `GET /api/tasks/:taskId` - Получить задачу по ID
- `POST /api/skin/save` - Сохранить скин
- `GET /api/skins/:type` - Список скинов по типу

## Добавление новых скинов

См. [SKINS.md](SKINS.md) для подробной информации о формате скинов.

Просто добавьте JSON файл в соответствующую директорию `public/skins/[тип]/`, и скин станет доступен без перезапуска сервера.

## Решение проблем

### Бот не отвечает на команды
- Убедитесь, что токен бота правильный в `.env`
- Проверьте, что сервер запущен
- Убедитесь, что бот не заблокирован

### Mini App не открывается
- Проверьте, что URL правильный и доступен
- Убедитесь, что используется HTTPS (для продакшена)
- Проверьте консоль браузера на ошибки

### База данных не создается
- Убедитесь, что у приложения есть права на запись в директорию
- Проверьте логи сервера на ошибки

## Дополнительные настройки

### Изменение порта

Измените `PORT` в файле `.env` или установите переменную окружения:
```bash
export PORT=8080
```

### Использование PostgreSQL вместо SQLite

Для продакшена рекомендуется использовать PostgreSQL. Нужно будет изменить код в `server.js` для использования `pg` вместо `sqlite3`.

