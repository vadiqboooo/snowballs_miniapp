# Решение проблемы "Ошибка инициализации"

## Шаг 1: Проверка консоли браузера

1. Откройте игру в Telegram
2. Нажмите F12 (или откройте DevTools)
3. Перейдите на вкладку "Console"
4. Найдите сообщения об ошибках

### Что искать:

- **"Ошибка: не удалось получить данные Telegram"** - приложение не открыто через Telegram
- **"Ошибка сервера: 500"** - проблема на сервере
- **"Ошибка сервера: 404"** - неправильный URL или сервер не запущен
- **"Failed to fetch"** - сервер недоступен или проблема с сетью
- **"Ошибка парсинга JSON"** - сервер вернул некорректный ответ

## Шаг 2: Проверка сервера

### Проверка, что сервер запущен:

```bash
# На сервере
docker compose ps

# Должны быть запущены контейнеры:
# - snowball-app
# - snowball-nginx
```

### Проверка логов сервера:

```bash
# Логи приложения
docker compose logs app

# Логи Nginx
docker compose logs nginx

# Все логи
docker compose logs -f
```

## Шаг 3: Проверка доступности API

### Проверка через curl:

```bash
# Проверка health endpoint
curl https://rancheasy.ru/api/health

# Должен вернуть: {"status":"ok","timestamp":"..."}
```

### Проверка в браузере:

Откройте в браузере: `https://rancheasy.ru/api/health`

Должен вернуться JSON: `{"status":"ok","timestamp":"..."}`

## Шаг 4: Проверка базы данных

```bash
# Вход в контейнер приложения
docker compose exec app sh

# Проверка базы данных
ls -la /app/data/

# Должен быть файл snowball.db
```

## Шаг 5: Проверка переменных окружения

```bash
# Проверка .env файла
cat .env

# Должен содержать:
# TELEGRAM_BOT_TOKEN=...
```

## Шаг 6: Перезапуск приложения

```bash
# Остановка
docker compose down

# Запуск
docker compose up -d

# Проверка логов
docker compose logs -f
```

## Частые проблемы и решения

### Проблема: "Failed to fetch"

**Причина:** Сервер недоступен или неправильный URL

**Решение:**
1. Проверьте, что сервер запущен: `docker compose ps`
2. Проверьте доступность: `curl https://rancheasy.ru/api/health`
3. Проверьте логи: `docker compose logs app`

### Проблема: "Ошибка сервера: 500"

**Причина:** Ошибка на сервере (база данных, код)

**Решение:**
1. Проверьте логи: `docker compose logs app`
2. Проверьте базу данных: `ls -la data/`
3. Проверьте права доступа: `chmod 755 data`

### Проблема: "Ошибка: не удалось получить данные Telegram"

**Причина:** Приложение открыто не через Telegram

**Решение:**
1. Откройте приложение через Telegram бота
2. Не открывайте напрямую в браузере

### Проблема: "Ошибка парсинга JSON"

**Причина:** Сервер вернул не JSON ответ (HTML страницу ошибки)

**Решение:**
1. Проверьте логи Nginx: `docker compose logs nginx`
2. Проверьте конфигурацию Nginx
3. Проверьте, что приложение отвечает на порту 3000

### Проблема: CORS ошибка

**Причина:** Проблема с CORS настройками

**Решение:**
1. Проверьте настройки CORS в `server.js`
2. Убедитесь, что Nginx правильно проксирует запросы

## Дополнительная диагностика

### Проверка сетевых запросов:

1. Откройте DevTools (F12)
2. Перейдите на вкладку "Network"
3. Обновите страницу
4. Найдите запрос к `/api/player/init`
5. Проверьте:
   - Status Code (должен быть 200)
   - Response (должен быть JSON)
   - Headers (проверьте CORS заголовки)

### Проверка конфигурации Nginx:

```bash
# Проверка конфигурации
docker compose exec nginx nginx -t

# Просмотр конфигурации
cat nginx/conf.d/default.conf
```

## Получение помощи

Если проблема не решена, соберите следующую информацию:

1. Логи сервера: `docker compose logs > server_logs.txt`
2. Скриншот консоли браузера с ошибками
3. Результат `curl https://rancheasy.ru/api/health`
4. Результат `docker compose ps`

